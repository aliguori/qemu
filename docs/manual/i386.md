QEMU PC System emulator
=======================

Introduction
------------

The QEMU PC System emulator simulates the
following peripherals:

 * i440FX host PCI bridge and PIIX3 PCI to ISA bridge
 * Cirrus CLGD 5446 PCI VGA card or dummy VGA card with Bochs VESA extensions
   (hardware level, including all non standard modes).
 * PS/2 mouse and keyboard
 * 2 PCI IDE interfaces with hard disk and CD-ROM support
 * Floppy disk
 * PCI and ISA network adapters
 * Serial ports
 * Creative SoundBlaster 16 sound card
 * ENSONIQ AudioPCI ES1370 sound card
 * Intel 82801AA AC97 Audio compatible sound card
 * Intel HD Audio Controller and HDA codec
 * Adlib (OPL2) - Yamaha YM3812 compatible chip
 * Gravis Ultrasound GF1 sound card
 * CS4231A compatible sound card
 * PCI UHCI USB controller and a virtual USB hub.

SMP is supported with up to 255 CPUs.

Note that adlib, gus and cs4231a are only available when QEMU was configured
with --audio-card-list option containing the name(s) of required card(s).

QEMU uses the PC BIOS from the Bochs project and the Plex86/Bochs LGPL VGA BIOS.

QEMU uses YM3812 emulation by Tatsuyuki Satoh.

QEMU uses GUS emulation ([GUSEMU32](http://www.deinmeister.de/gusemu/)) by
Tibor "TS" Sch√ºtz.

Note that, by default, GUS shares IRQ(7) with parallel ports and so qemu must
be told to not have parallel ports to have working GUS

    qemu dos.img -soundhw gus -parallel none

Alternatively:

    qemu dos.img -device gus,irq=5

Or some other unclaimed IRQ.

CS4231A is the chip used in Windows Sound System and GUSMAX products

Quick Start
-----------

Download and uncompress the linux image (*linux.img*) and type:

    qemu linux.img

Linux should boot and give you a prompt.

Invocation
----------

    usage: qemu [options] [*disk_image*]

Options
-------

*disk_image* is a raw hard disk image for IDE hard disk 0. Some targets do
not need a disk image.

Target OS specific information
------------------------------

### Linux

To have access to SVGA graphic modes under X11, use the *vesa* or the *cirrus*
X11 driver. For optimal performances, use 16 bit color depth in the guest and
the host OS.

When using a 2.6 guest Linux kernel, you should add the option *clock=pit* on
the kernel command line because the 2.6 Linux kernels make very strict real
time clock checks by default that QEMU cannot simulate exactly.

When using a 2.6 guest Linux kernel, verify that the 4G/4G patch is not
activated because QEMU is slower with this patch. The QEMU Accelerator Module
is also much slower in this case. Earlier Fedora Core 3 Linux kernel
(< 2.6.9-1.724_FC3) were known to incorporate this patch by default. Newer
kernels don't have it.

### Windows

If you have a slow host, using Windows 95 is better as it gives the best speed.
Windows 2000 is also a good choice.

#### SVGA graphic modes support

QEMU emulates a Cirrus Logic GD5446 Video card. All Windows versions starting
from Windows 95 should recognize and use this graphic card. For optimal
performances, use 16 bit color depth in the guest and the host OS.

If you are using Windows XP as guest OS and if you want to use high resolution
modes which the Cirrus Logic BIOS does not support (i.e. >= 1280x1024x16), then
you should use the VESA VBE virtual graphic card (option *-std-vga*).

#### CPU usage reduction

Windows 9x does not correctly use the CPU HLT instruction. The result is that
it takes host CPU cycles even when idle. You can install the utility [amnhtlm][]
to solve this problem. Note that no such tool is needed for NT, 2000 or XP.

#### Windows 2000 disk full problem

Windows 2000 has a bug which gives a disk full problem during its installation.
When installing it, use the *-win2k-hack* QEMU option to enable a specific
workaround. After Windows 2000 is installed, you no longer need this option
(this option slows down the IDE transfers).

#### Windows 2000 shutdown

Windows 2000 cannot automatically shutdown in QEMU although Windows 98 can. It
comes from the fact that Windows 2000 does not automatically use the APM driver
provided by the BIOS.

In order to correct that, do the following (thanks to Struan Bartlett): go to
the Control Panel => Add/Remove Hardware & Next => Add/Troubleshoot a device =>
Add a new device & Next => No, select the hardware from a list & Next => NT
Apm/Legacy Support & Next => Next (again) a few times. Now the driver is
installed and Windows 2000 now correctly instructs QEMU to shutdown at the
appropriate moment.

#### Share a directory between Unix and Windows

See Invocation about the help of the option *-smb*.

#### Windows XP security problem

Some releases of Windows XP install correctly but give a security error when
booting:

    A problem is preventing Windows from accurately checking the license for
    this computer. Error code: 0x800703e6.

The workaround is to install a service pack for XP after a boot in safe mode.
Then reboot, and the problem should go away. Since there is no network while in
safe mode, its recommended to download the full installation of SP1 or SP2 and
transfer that via an ISO or using the vvfat block device
("-hdb fat:directory_which_holds_the_SP").

### MS-DOS and FreeDOS

#### CPU usage reduction

DOS does not correctly use the CPU HLT instruction. The result is that it takes
host CPU cycles even when idle. You can install the utility [dosidle][] to solve
this problem.

[amnhtlm]: http://www.user.cityline.ru/~maxamn/amnhltm.zip
[dosidle]: http://www.vmware.com/software/dosidle210.zip
